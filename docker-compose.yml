version: "3.8"

services:
  archivist:
    build: .
    image: archivist:latest
    container_name: archivist
    ports:
      - "8080:8080"
    volumes:
      # Configuration storage (persists config.json and database)
      - ./data/config:/data/config
      # Source directories (create symlinks here to actual backup sources)
      - ./data/sources:/data/sources
      # Temporary storage for archive creation
      - ./data/temp:/data/temp
    environment:
      # Logging level: debug, info, warn, error
      - LOG_LEVEL=info
      # HTTP server port
      - HTTP_PORT=8080
      # Maximum concurrent backup tasks
      - MAX_CONCURRENT_TASKS=3
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:8080/api/v1/system/health",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
# Optional: Create named volumes instead of local directories
# volumes:
#   archivist_config:
#   archivist_sources:
#   archivist_temp:
