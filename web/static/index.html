<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivist - Backup Manager</title>
    <link rel="stylesheet" href="/css/style.css">

    <!-- htmx for AJAX interactions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/2.0.7/htmx.min.js"
        integrity="sha512-IisGoumHahmfNIhP4wUV3OhgQZaaDBuD6IG4XlyjT77IUkwreZL3T3afO4xXuDanSalZ57Un+UlAbarQjNZCTQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Alpine.js for reactive UI components -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.15.0/cdn.js"
        integrity="sha512-nHfCQtLDRfNgzsuMx2O2Joo3+xM8antMOBxo9GodZry1h33+lWa2Dd3a/lkVY4fHJK1CAkFcUrz2jilsaZFWeQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body x-data="{
    currentView: 'dashboard'
}">
    <div class="container">
        <header>
            <h1>Archivist</h1>
            <p class="subtitle">Multi-Cloud Backup Manager</p>
        </header>

        <nav>
            <button class="nav-btn" :class="{ 'active': currentView === 'dashboard' }"
                @click="currentView = 'dashboard'">
                Dashboard
            </button>
            <button class="nav-btn" :class="{ 'active': currentView === 'tasks' }" @click="currentView = 'tasks'">
                Tasks
            </button>
            <button class="nav-btn" :class="{ 'active': currentView === 'backends' }" @click="currentView = 'backends'">
                Backends
            </button>
            <button class="nav-btn" :class="{ 'active': currentView === 'history' }" @click="currentView = 'history'">
                History
            </button>
        </nav>

        <main>
            <!-- Dashboard View -->
            <div x-show="currentView === 'dashboard'" hx-get="/api/v1/dashboard/html" hx-trigger="revealed"
                hx-swap="innerHTML">
                <h2>Dashboard</h2>
                <p class="empty-state">Loading dashboard...</p>
            </div>

            <!-- Tasks View -->
            <div x-show="currentView === 'tasks'"
                x-data="{ showCreateModal: false, showEditModal: false, showDryRunModal: false, editTaskId: '', dryRunData: null }"
                @open-task-edit-modal.window="showEditModal = true"
                @open-task-dry-run-modal.window="showDryRunModal = true"
                @close-task-edit-modal.window="showEditModal = false"
                @close-task-dry-run-modal.window="showDryRunModal = false"
                @close-create-modal.window="showCreateModal = false">
                <div class="view-header">
                    <h2>Backup Tasks</h2>
                    <button class="btn btn-primary" @click="showCreateModal = true;
                        $nextTick(() => htmx.trigger('#create-task-modal', 'loadForm'))">
                        + New Task
                    </button>
                </div>

                <!-- Tasks List -->
                <div hx-get="/api/v1/tasks/html" hx-trigger="revealed, taskUpdated from:body" hx-swap="innerHTML">
                    <p class="empty-state">Loading tasks...</p>
                </div>

                <!-- Create Task Modal -->
                <div x-show="showCreateModal" @click.self="showCreateModal = false" class="modal"
                    :class="{ 'active': showCreateModal }">
                    <div class="modal-content">
                        <span class="close" @click="showCreateModal = false">&times;</span>
                        <div id="create-task-modal" hx-get="/api/v1/tasks/form/create" hx-trigger="loadForm"
                            hx-swap="innerHTML"></div>
                    </div>
                </div>

                <!-- Edit Task Modal -->
                <div x-show="showEditModal" @click.self="showEditModal = false" class="modal"
                    :class="{ 'active': showEditModal }">
                    <div class="modal-content">
                        <span class="close" @click="showEditModal = false">&times;</span>
                        <div id="edit-task-modal"></div>
                    </div>
                </div>

                <!-- Dry Run Results Modal -->
                <div x-show="showDryRunModal" @click.self="showDryRunModal = false" class="modal"
                    :class="{ 'active': showDryRunModal }">
                    <div class="modal-content">
                        <span class="close" @click="showDryRunModal = false">&times;</span>
                        <div id="dry-run-modal"></div>
                    </div>
                </div>
            </div>

            <!-- Backends View -->
            <div x-show="currentView === 'backends'"
                x-data="{ showCreateModal: false, showEditModal: false, editBackendId: '' }"
                @open-backend-edit-modal.window="showEditModal = true"
                @close-backend-edit-modal.window="showEditModal = false">
                <div class="view-header">
                    <h2>Storage Backends</h2>
                    <button class="btn btn-primary" @click="showCreateModal = true;
                        $nextTick(() => htmx.trigger('#create-backend-modal', 'loadForm'))">
                        + New Backend
                    </button>
                </div>

                <!-- Backends List -->
                <div hx-get="/api/v1/backends/html" hx-trigger="revealed, backendUpdated from:body" hx-swap="innerHTML">
                    <p class="empty-state">Loading backends...</p>
                </div>

                <!-- Create Backend Modal -->
                <div x-show="showCreateModal" @click.self="showCreateModal = false" class="modal"
                    :class="{ 'active': showCreateModal }">
                    <div class="modal-content">
                        <span class="close" @click="showCreateModal = false">&times;</span>
                        <div id="create-backend-modal" hx-get="/api/v1/backends/form/create" hx-trigger="loadForm"
                            hx-swap="innerHTML"></div>
                    </div>
                </div>

                <!-- Edit Backend Modal -->
                <div x-show="showEditModal" @click.self="showEditModal = false" class="modal"
                    :class="{ 'active': showEditModal }">
                    <div class="modal-content">
                        <span class="close" @click="showEditModal = false">&times;</span>
                        <div id="edit-backend-modal"></div>
                    </div>
                </div>
            </div>

            <!-- History View -->
            <div x-show="currentView === 'history'">
                <div class="view-header">
                    <h2>Execution History</h2>
                    <button class="btn btn-danger" hx-delete="/api/v1/executions"
                        hx-confirm="Are you sure you want to clear all history?" hx-target="next div"
                        hx-swap="innerHTML">
                        Clear History
                    </button>
                </div>

                <!-- History List -->
                <div hx-get="/api/v1/executions/html" hx-trigger="revealed, historyUpdated from:body"
                    hx-swap="innerHTML">
                    <p class="empty-state">Loading history...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notifications Container -->
    <div id="toast-container"></div>

    <!-- Toast Template -->
    <template id="toast-template">
        <div class="toast">
            <div class="toast-icon" data-field="icon"></div>
            <div class="toast-content">
                <div class="toast-title" data-field="title"></div>
                <div class="toast-message" data-field="message"></div>
            </div>
            <button class="toast-close" onclick="window.closeToast(this)">&times;</button>
        </div>
    </template>

    <script src="/js/app.js"></script>
</body>

</html>
