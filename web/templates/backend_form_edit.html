<h2>Edit Backend</h2>
<form hx-put="/api/v1/backends/{{.ID}}" hx-ext="json-enc" hx-swap="none"
    hx-on::after-request="if(event.detail.successful) { window.dispatchEvent(new CustomEvent('close-backend-edit-modal')); htmx.trigger('body', 'backendUpdated'); showToast('Backend updated successfully', 'success'); } else { showToast('Failed to update backend', 'error'); }"
    x-data="{ type: '{{.Type}}' }">

    <div class="form-group">
        <label>Backend Name *</label>
        <input type="text" name="name" value="{{.Name}}" required>
    </div>

    <div class="form-group">
        <label>Backend Type *</label>
        <select name="type" x-model="type" disabled>
            <option value="local">Local Filesystem</option>
            <option value="s3">AWS S3 / S3-Compatible</option>
            <option value="gcs">Google Cloud Storage</option>
            <option value="gdrive">Google Drive</option>
            <option value="azure">Azure Blob Storage</option>
            <option value="b2">Backblaze B2</option>
        </select>
        <small style="color: #888;">Type cannot be changed after creation</small>
    </div>

    <div x-show="type === 'local'">
        <div class="form-group">
            <label>Local Path *</label>
            <input type="text" name="config_path" value="{{index .Config " path"}}" placeholder="/backup/destination">
        </div>
    </div>

    <div x-show="type === 's3'" style="display: none;">
        <div class="form-group">
            <label>Bucket Name *</label>
            <input type="text" name="config_bucket" value="{{index .Config " bucket"}}">
        </div>
        <div class="form-group">
            <label>Region *</label>
            <input type="text" name="config_region" value="{{index .Config " region"}}" placeholder="us-east-1">
        </div>
        <div class="form-group">
            <label>Access Key ID</label>
            <input type="text" name="config_access_key_id" value="{{index .Config " access_key_id"}}">
        </div>
        <div class="form-group">
            <label>Secret Access Key</label>
            <input type="password" name="config_secret_access_key" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing secret</small>
        </div>
    </div>

    <div x-show="type === 'gcs'" style="display: none;">
        <div class="form-group">
            <label>Bucket Name *</label>
            <input type="text" name="config_bucket" value="{{index .Config " bucket"}}">
        </div>
        <div class="form-group">
            <label>Project ID</label>
            <input type="text" name="config_project_id" value="{{index .Config " project_id"}}">
        </div>
        <div class="form-group">
            <label>Service Account Key (JSON)</label>
            <textarea name="config_credentials_json" rows="5"
                placeholder="Leave blank to keep existing">{{index .Config "credentials_json"}}</textarea>
            <small style="color: #888;">Leave blank to keep existing credentials</small>
        </div>
    </div>

    <div x-show="type === 'gdrive'" style="display: none;">
        <div class="form-group">
            <label>Folder ID</label>
            <input type="text" name="config_folder_id" value="{{index .Config " folder_id"}}"
                placeholder="Google Drive folder ID">
        </div>
        <div class="form-group">
            <label>OAuth Client ID</label>
            <input type="text" name="config_client_id" value="{{index .Config " client_id"}}">
        </div>
        <div class="form-group">
            <label>OAuth Client Secret</label>
            <input type="password" name="config_client_secret" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing secret</small>
        </div>
    </div>

    <div x-show="type === 'azure'" style="display: none;">
        <div class="form-group">
            <label>Container Name *</label>
            <input type="text" name="config_container" value="{{index .Config " container"}}">
        </div>
        <div class="form-group">
            <label>Account Name *</label>
            <input type="text" name="config_account_name" value="{{index .Config " account_name"}}">
        </div>
        <div class="form-group">
            <label>Account Key</label>
            <input type="password" name="config_account_key" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing key</small>
        </div>
    </div>

    <div x-show="type === 'b2'" style="display: none;">
        <div class="form-group">
            <label>Bucket Name *</label>
            <input type="text" name="config_bucket" value="{{index .Config " bucket"}}">
        </div>
        <div class="form-group">
            <label>Application Key ID</label>
            <input type="text" name="config_key_id" value="{{index .Config " key_id"}}">
        </div>
        <div class="form-group">
            <label>Application Key</label>
            <input type="password" name="config_application_key" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing key</small>
        </div>
    </div>

    <div class="form-group">
        <label>Backend Status</label>
        <select name="enabled">
            <option value="true" {{if .Enabled}}selected{{end}}>Enabled</option>
            <option value="false" {{if not .Enabled}}selected{{end}}>Disabled</option>
        </select>
    </div>

    <div class="form-actions">
        <button type="button" class="btn"
            @click="window.dispatchEvent(new CustomEvent('close-backend-edit-modal'))">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </div>
</form>
