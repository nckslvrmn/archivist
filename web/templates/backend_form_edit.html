<h2>Edit Backend</h2>
<form hx-put="/api/v1/backends/{{.ID}}" hx-swap="none"
    hx-on::after-request="if(event.detail.successful) { window.dispatchEvent(new CustomEvent('close-backend-edit-modal')); htmx.trigger('body', 'backendUpdated'); showToast('Backend updated successfully', 'success'); } else { showToast('Failed to update backend', 'error'); }"
    x-data="{ type: '{{.Type}}' }">

    <div class="form-group">
        <label>Backend Name *</label>
        <input type="text" name="name" value="{{.Name}}" required>
    </div>

    <div class="form-group">
        <label>Backend Type *</label>
        <select name="type" x-model="type" disabled>
            <option value="local">Local Filesystem</option>
            <option value="s3">AWS S3 / S3-Compatible</option>
            <option value="gcs">Google Cloud Storage</option>
            <option value="gdrive">Google Drive</option>
            <option value="azure">Azure Blob Storage</option>
            <option value="b2">Backblaze B2</option>
        </select>
        <small style="color: #888;">Type cannot be changed after creation</small>
    </div>

    <div x-show="type === 'local'">
        <div class="form-group">
            <label>Local Path *</label>
            <input type="text" name="config_path" value="{{index .Config " path"}}" placeholder="/backup/destination">
        </div>
    </div>

    <div x-show="type === 's3'" style="display: none;">
        <div class="form-group">
            <label>Bucket Name *</label>
            <input type="text" name="config_bucket" value="{{index .Config " bucket"}}">
        </div>
        <div class="form-group">
            <label>Region *</label>
            <input type="text" name="config_region" value="{{index .Config " region"}}" placeholder="us-east-1">
        </div>
        <div class="form-group">
            <label>Access Key ID</label>
            <input type="text" name="config_access_key_id" value="{{index .Config " access_key_id"}}">
        </div>
        <div class="form-group">
            <label>Secret Access Key</label>
            <input type="password" name="config_secret_access_key" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing secret</small>
        </div>
        <div class="form-group">
            <label>Custom Endpoint (for S3-compatible storage)</label>
            <input type="text" name="config_endpoint" value="{{index .Config " endpoint"}}" placeholder="https://minio.example.com:9000">
            <small style="color: #888;">Optional: For MinIO, DigitalOcean Spaces, etc.</small>
        </div>
        <div class="form-group">
            <label>Path Prefix</label>
            <input type="text" name="config_prefix" value="{{index .Config " prefix"}}" placeholder="archivist">
            <small style="color: #888;">Optional: Organize backups within bucket</small>
        </div>
        <div class="form-group">
            <label>Storage Tier (Class)</label>
            <select name="config_storage_tier">
                <option value="STANDARD" {{if eq (index .Config " storage_tier") "STANDARD"}}selected{{end}}>Standard (default, frequent access)</option>
                <option value="STANDARD_IA" {{if eq (index .Config " storage_tier") "STANDARD_IA"}}selected{{end}}>Standard-IA (infrequent access, lower cost)</option>
                <option value="ONEZONE_IA" {{if eq (index .Config " storage_tier") "ONEZONE_IA"}}selected{{end}}>One Zone-IA (single AZ, lowest IA cost)</option>
                <option value="INTELLIGENT_TIERING" {{if eq (index .Config " storage_tier") "INTELLIGENT_TIERING"}}selected{{end}}>Intelligent-Tiering (automatic optimization)</option>
                <option value="GLACIER_IR" {{if eq (index .Config " storage_tier") "GLACIER_IR"}}selected{{end}}>Glacier Instant Retrieval (archival, instant)</option>
                <option value="GLACIER" {{if eq (index .Config " storage_tier") "GLACIER"}}selected{{end}}>Glacier Flexible Retrieval (3-5hr retrieval)</option>
                <option value="DEEP_ARCHIVE" {{if eq (index .Config " storage_tier") "DEEP_ARCHIVE"}}selected{{end}}>Glacier Deep Archive (12hr retrieval, cheapest)</option>
            </select>
            <small style="color: #888;">Choose based on access frequency. Lower tiers = lower storage cost but retrieval fees/delays.</small>
        </div>
    </div>

    <div x-show="type === 'gcs'" style="display: none;">
        <div class="form-group">
            <label>Bucket Name *</label>
            <input type="text" name="config_bucket" value="{{index .Config " bucket"}}">
        </div>
        <div class="form-group">
            <label>Credentials File Path</label>
            <input type="text" name="config_credentials_file" value="{{index .Config " credentials_file"}}" placeholder="config/gcs-service-account.json">
            <small style="color: #888;">Path to service account JSON key (relative to root)</small>
        </div>
        <div class="form-group">
            <label>OR Credentials JSON</label>
            <textarea name="config_credentials_json" rows="4" placeholder="Leave blank to keep existing">{{index .Config "credentials_json"}}</textarea>
            <small style="color: #888;">Paste service account JSON directly</small>
        </div>
        <div class="form-group">
            <label>Project ID</label>
            <input type="text" name="config_project_id" value="{{index .Config " project_id"}}">
        </div>
        <div class="form-group">
            <label>Path Prefix</label>
            <input type="text" name="config_prefix" value="{{index .Config " prefix"}}" placeholder="archivist">
            <small style="color: #888;">Optional: Organize backups within bucket</small>
        </div>
        <div class="form-group">
            <label>Storage Class</label>
            <select name="config_storage_tier">
                <option value="STANDARD" {{if eq (index .Config " storage_tier") "STANDARD"}}selected{{end}}>Standard (default, frequent access)</option>
                <option value="NEARLINE" {{if eq (index .Config " storage_tier") "NEARLINE"}}selected{{end}}>Nearline (30-day minimum, lower cost)</option>
                <option value="COLDLINE" {{if eq (index .Config " storage_tier") "COLDLINE"}}selected{{end}}>Coldline (90-day minimum, very low cost)</option>
                <option value="ARCHIVE" {{if eq (index .Config " storage_tier") "ARCHIVE"}}selected{{end}}>Archive (365-day minimum, cheapest)</option>
            </select>
            <small style="color: #888;">Choose based on access frequency. Lower tiers = lower storage cost but retrieval fees.</small>
        </div>
    </div>

    <div x-show="type === 'gdrive'" style="display: none;">
        <div class="form-group">
            <label>Credentials File Path</label>
            <input type="text" name="config_credentials_file" value="{{index .Config " credentials_file"}}" placeholder="config/gdrive-service-account.json">
            <small style="color: #888;">Path to service account JSON key (relative to root)</small>
        </div>
        <div class="form-group">
            <label>OR Credentials JSON</label>
            <textarea name="config_credentials_json" rows="4" placeholder="Leave blank to keep existing">{{index .Config "credentials_json"}}</textarea>
            <small style="color: #888;">Paste service account JSON directly</small>
        </div>
        <div class="form-group">
            <label>Folder Name</label>
            <input type="text" name="config_folder_name" value="{{index .Config " folder_name"}}" placeholder="archivist-backups">
            <small style="color: #888;">Name of folder to create/use in Drive</small>
        </div>
        <div class="form-group">
            <label>OR Specific Folder ID</label>
            <input type="text" name="config_folder_id" value="{{index .Config " folder_id"}}" placeholder="1aBcDeFgHiJkLmNoPqRsTuVwXyZ">
            <small style="color: #888;">Use specific folder ID (overrides folder name)</small>
        </div>
    </div>

    <div x-show="type === 'azure'" style="display: none;" x-data="{ authMethod: '{{if index .Config \" account_key\"}}account_key{{else if index .Config \" sas_token\"}}sas_token{{else if index .Config \" connection_string\"}}connection_string{{else}}account_key{{end}}' }">
        <div class="form-group">
            <label>Container Name *</label>
            <input type="text" name="config_container" value="{{index .Config " container"}}">
        </div>
        <div class="form-group">
            <label>Account Name *</label>
            <input type="text" name="config_account_name" value="{{index .Config " account_name"}}">
        </div>
        <div class="form-group">
            <label>Authentication Method *</label>
            <select x-model="authMethod">
                <option value="account_key">Account Key</option>
                <option value="sas_token">SAS Token</option>
                <option value="connection_string">Connection String</option>
            </select>
        </div>
        <div class="form-group" x-show="authMethod === 'account_key'">
            <label>Account Key</label>
            <input type="password" name="config_account_key" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing key</small>
        </div>
        <div class="form-group" x-show="authMethod === 'sas_token'" style="display: none;">
            <label>SAS Token</label>
            <input type="text" name="config_sas_token" value="{{index .Config " sas_token"}}" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing token</small>
        </div>
        <div class="form-group" x-show="authMethod === 'connection_string'" style="display: none;">
            <label>Connection String</label>
            <textarea name="config_connection_string" rows="3" placeholder="Leave blank to keep existing">{{index .Config " connection_string"}}</textarea>
            <small style="color: #888;">Leave blank to keep existing connection string</small>
        </div>
        <div class="form-group">
            <label>Path Prefix</label>
            <input type="text" name="config_prefix" value="{{index .Config " prefix"}}" placeholder="archivist">
            <small style="color: #888;">Optional: Organize backups within container</small>
        </div>
        <div class="form-group">
            <label>Access Tier</label>
            <select name="config_storage_tier">
                <option value="" {{if not (index .Config " storage_tier")}}selected{{end}}>Account Default</option>
                <option value="Hot" {{if eq (index .Config " storage_tier") "Hot"}}selected{{end}}>Hot (frequent access, highest cost)</option>
                <option value="Cool" {{if eq (index .Config " storage_tier") "Cool"}}selected{{end}}>Cool (30-day minimum, lower cost)</option>
                <option value="Cold" {{if eq (index .Config " storage_tier") "Cold"}}selected{{end}}>Cold (90-day minimum, very low cost)</option>
                <option value="Archive" {{if eq (index .Config " storage_tier") "Archive"}}selected{{end}}>Archive (180-day minimum, cheapest, rehydration required)</option>
            </select>
            <small style="color: #888;">Choose based on access frequency. Lower tiers = lower storage cost but retrieval delays.</small>
        </div>
    </div>

    <div x-show="type === 'b2'" style="display: none;">
        <div class="form-group">
            <label>Bucket Name *</label>
            <input type="text" name="config_bucket" value="{{index .Config " bucket"}}">
        </div>
        <div class="form-group">
            <label>Application Key ID</label>
            <input type="text" name="config_key_id" value="{{index .Config " key_id"}}">
        </div>
        <div class="form-group">
            <label>Application Key</label>
            <input type="password" name="config_application_key" placeholder="Leave blank to keep existing">
            <small style="color: #888;">Leave blank to keep existing key</small>
        </div>
        <div class="form-group">
            <label>Path Prefix</label>
            <input type="text" name="config_prefix" value="{{index .Config " prefix"}}" placeholder="archivist">
            <small style="color: #888;">Optional: Organize backups within bucket</small>
        </div>
    </div>

    <div class="form-group">
        <label>Backend Status</label>
        <select name="enabled">
            <option value="true" {{if .Enabled}}selected{{end}}>Enabled</option>
            <option value="false" {{if not .Enabled}}selected{{end}}>Disabled</option>
        </select>
    </div>

    <div class="form-actions">
        <button type="button" class="btn"
            @click="window.dispatchEvent(new CustomEvent('close-backend-edit-modal'))">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </div>
</form>
