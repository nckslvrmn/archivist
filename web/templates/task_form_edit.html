<h2>Edit Task</h2>
<form hx-put="/api/v1/tasks/{{.Task.ID}}" hx-swap="none"
    hx-on::after-request="if(event.detail.successful) { window.dispatchEvent(new CustomEvent('close-task-edit-modal')); htmx.trigger('body', 'taskUpdated'); showToast('Task updated successfully', 'success'); } else { showToast('Failed to update task', 'error'); }"
    x-data="{
          scheduleType: '{{.Task.Schedule.Type}}',
          backupMode: '{{.Task.ArchiveOptions.Format}}',
          useTimestamp: '{{if .Task.ArchiveOptions.UseTimestamp}}true{{else}}false{{end}}'
      }">

    <div class="form-group">
        <label>Task Name *</label>
        <input type="text" name="name" value="{{.Task.Name}}" required>
    </div>

    <div class="form-group">
        <label>Description</label>
        <textarea name="description" rows="3">{{.Task.Description}}</textarea>
    </div>

    <div class="form-group">
        <label>Source Path *</label>
        <input type="text" name="source_path" value="{{.Task.SourcePath}}" required>
    </div>

    <div class="form-group">
        <label>Storage Backend(s) *</label>
        <div class="backend-selector">
            {{range $backend := .Backends}}
            <label class="backend-option">
                <input type="checkbox" name="backend_ids" value="{{$backend.ID}}" {{range $.Task.BackendIDs}}{{if eq .
                    $backend.ID}}checked{{end}}{{end}}>
                <span class="backend-option-content">
                    <span class="backend-option-name">{{$backend.Name}}</span>
                    <span class="backend-option-type">{{$backend.Type}}</span>
                </span>
            </label>
            {{end}}
        </div>
    </div>

    <div class="form-group">
        <label>Schedule Type *</label>
        <select name="schedule_type" x-model="scheduleType">
            <option value="simple">Simple</option>
            <option value="cron">Cron</option>
            <option value="manual">Manual</option>
        </select>
    </div>

    <div class="form-group" x-show="scheduleType === 'simple'">
        <label>Frequency</label>
        <select name="simple_type">
            <option value="hourly" {{if eq .Task.Schedule.SimpleType "hourly" }}selected{{end}}>Hourly</option>
            <option value="daily" {{if eq .Task.Schedule.SimpleType "daily" }}selected{{end}}>Daily</option>
            <option value="weekly" {{if eq .Task.Schedule.SimpleType "weekly" }}selected{{end}}>Weekly</option>
            <option value="monthly" {{if eq .Task.Schedule.SimpleType "monthly" }}selected{{end}}>Monthly</option>
        </select>
    </div>

    <div class="form-group" x-show="scheduleType === 'cron'" style="display: none;">
        <label>Cron Expression</label>
        <input type="text" name="cron_expr" value="{{.Task.Schedule.CronExpr}}" placeholder="0 2 * * *">
    </div>

    <div class="form-group">
        <label>Backup Mode *</label>
        <select name="backup_mode" x-model="backupMode">
            <option value="archive">Archive (Compressed)</option>
            <option value="sync">Sync (File-by-file)</option>
        </select>
    </div>

    <div x-show="backupMode === 'archive'">
        <div class="form-group">
            <label>Use Timestamp in Filename</label>
            <select name="use_timestamp" x-model="useTimestamp">
                <option value="true">Yes (Point-in-time backups)</option>
                <option value="false">No (Mirror/overwrite)</option>
            </select>
        </div>

        <div class="form-group" x-show="useTimestamp === 'true'">
            <label>Retention (Keep Last N Backups, 0 = unlimited)</label>
            <input type="number" name="keep_last" value="{{.Task.RetentionPolicy.KeepLast}}">
        </div>
    </div>

    <div x-show="backupMode === 'sync'" style="display: none;">
        <div class="form-group">
            <label>Delete Remote Files</label>
            <select name="delete_remote">
                <option value="false" {{if not .Task.ArchiveOptions.SyncOptions.DeleteRemote}}selected{{end}}>No (Safer)
                </option>
                <option value="true" {{if .Task.ArchiveOptions.SyncOptions.DeleteRemote}}selected{{end}}>Yes (True
                    mirror)</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label>Task Status</label>
        <select name="enabled">
            <option value="false" {{if not .Task.Enabled}}selected{{end}}>Disabled</option>
            <option value="true" {{if .Task.Enabled}}selected{{end}}>Enabled</option>
        </select>
    </div>

    <div class="form-actions">
        <button type="button" class="btn"
            @click="window.dispatchEvent(new CustomEvent('close-task-edit-modal'))">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </div>
</form>
